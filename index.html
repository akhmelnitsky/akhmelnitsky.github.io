<!DOCTYPE html>
<html>
      <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <title>Генератор ОРД</title>
    </head>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.31.2/docxtemplater.js"></script>
        <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
        <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils.js"></script>
        <!--
Mandatory in IE 6, 7, 8 and 9.
-->
        <!--[if IE]>
            <script
                type="text/javascript"
                src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils-ie.js"
            ></script>
        <![endif]-->
        
     <!-- input feed for document-->
      <!--  <textarea rows="25" cols="100" id="input_json_params">
        {
          "second_comission_date": "15.08.2022",
          "queue_number": "16.1",
          "queue_title": "Сервис '15 партнерских услуг'(4.2.16 (в части требований, приведенных в пп. 1.1. (по не более чем 4 новым услугам), 2 (в количестве не более чем 4), 3.2.)",
          "queue_purpose": "Доработка процесса оказания услуги на базе сервиса 'Экспертная платформа' в часте подтвверждения опыта партнеров, а также создание 4 новых услуг",
          "trial_start_act_date": "15.08.2022",
          "trial_start": "15.08.2022",
          "trial_end": "15.08.2022",
          "second_notification":  "30.09.2021 №488/УД (вх. от 30.09.2021 №8780/РЭЦ)",
          "trial_experpise_start": "15.08.2022",
          "trial_experpise_end": "15.08.2022",
          "final_acceptance_act_date": "15.08.2022",
          "final_comission_start_date": "15.08.2022",
          "final_comission_end_date": "15.08.2022"
        }
        </textarea> -->
        <div class="container">
             <div class="row">
                  <div class="col">
                        <h1>Данные для документов</h1>
                  </div>
            </div>
             <div class="row">
                  <div class="col-4">
                        <p>Дата комиссии по окончании ОЭ (second_comission_date)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="second_comission_date" value="15.08.2022">
                        </div>
                  </div>
            </div>
             <div class="row">
                  <div class="col-4">
                        <p>Номер очереди (queue_number)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="queue_number" value="16.1">
                        </div>
                  </div>
            </div>
            <div class="row">
                  <div class="col-4">
                        <p>Название очереди/сервиса (queue_title)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <textarea class="form-control" id="queue_title" rows="3">Сервис '15 партнерских услуг'(4.2.16 (в части требований, приведенных в пп. 1.1. (по не более чем 4 новым услугам), 2 (в количестве не более чем 4), 3.2.)</textarea>
                        </div>
                  </div>
           </div>
            <div class="row">
                  <div class="col-4">
                        <p>Назначение очереди/сервиса (queue_purpose)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <textarea class="form-control" id="queue_purpose" rows="3">Доработка процесса оказания услуги на базе сервиса 'Экспертная платформа' в часте подтвверждения опыта партнеров, а также создание 4 новых услуг</textarea>
                        </div>
                  </div>
           </div>
             <div class="row">
                  <div class="col-4">
                        <p>Дата акта вывода в ОЭ (trial_start_act_date)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="trial_start_act_date" value="10.04.2021">
                        </div>
                  </div>
            </div>
             <div class="row">
                  <div class="col-4">
                        <p>Дата начала ОЭ (trial_start)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="trial_start" value="18.08.2022">
                        </div>
                  </div>
            </div>
             <div class="row">
                  <div class="col-4">
                        <p>Дата акта окончания ОЭ (trial_end)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="trial_end" value="18.08.2022">
                        </div>
                  </div>
            </div>
            <div class="row">
                  <div class="col-4">
                        <p>Уведомлние об окончании ОЭ (second_notification)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <textarea class="form-control" id="second_notification" rows="2">30.09.2021 №488/УД (вх. от 30.09.2021 №8780/РЭЦ)</textarea>
                        </div>
                  </div>
           </div>
             <div class="row">
                  <div class="col-4">
                        <p>Дата начала комиссии об окончании ОЭ (trial_experpise_start)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="trial_experpise_start" value="18.08.2022">
                        </div>
                  </div>
            </div>
              <div class="row">
                  <div class="col-4">
                        <p>Дата конца комиссии об окончании ОЭ9 (trial_experpise_end)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="trial_experpise_end" value="18.08.2022">
                        </div>
                  </div>
            </div>
              <div class="row">
                  <div class="col-4">
                        <p>Дата акта приемочных испытаний (final_acceptance_act_date)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="final_acceptance_act_date" value="18.08.2022">
                        </div>
                  </div>
            </div>
              <div class="row">
                  <div class="col-4">
                        <p>Дата начала комиссии по приемочным (final_comission_start_date)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="final_comission_start_date" value="18.08.2022">
                        </div>
                  </div>
            </div>
              <div class="row">
                  <div class="col-4">
                        <p>Дата конца комиссии по приемочным (final_comission_end_date)</p>
                  </div>
                  <div class="col-8">
                        <div class="mb-3">
                              <input class="form-control" type="text" id="final_comission_end_date" value="18.08.2022">
                        </div>
                  </div>
            </div>
        
<!--        <input type="file" id="doc" /> -->
        <h1>Сгенерировать документы</h1>
<!--        <h2>ОРД1</h2>
        
        <p>Проект журнала опытной эксплуатации</p>
        <p>Проект протокола предварительных испытаний</p>        
        <p>Проект акта приёмки в опытную эксплуатацию</p>       
        <p>Проект протокола опытной эксплуатации</p>
        <p>Проект акта о завершении опытной эксплуатации и допуске к приемочным испытаниям</p>
        <p>Протокол предварительных испытаний</p>
        <p>Журнал проведения инструктажа</p>
        <p>Акт приемки в опытную эксплуатацию</p>
        <p>Отчет о результатах тестирования ключевых пользователей</p>
        <p>Акт о проведении инструктажа пользователей</p> 
        <p>Экспертное заключение</p> -->
             <div class="row">
                  <div class="col">
                        <h2>ОРД1</h2>
                  </div>
            </div>
             <div class="row">
                  <div class="col">
                        <p>Проект журнала опытной эксплуатации</p>
                        <p>Проект протокола предварительных испытаний</p>        
                        <p>Проект акта приёмки в опытную эксплуатацию</p>       
                        <p>Проект протокола опытной эксплуатации</p>
                        <p>Проект акта о завершении опытной эксплуатации и допуске к приемочным испытаниям</p>
                        <p>Протокол предварительных испытаний</p>
                        <p>Журнал проведения инструктажа</p>
                        <p>Акт приемки в опытную эксплуатацию</p>
                        <p>Отчет о результатах тестирования ключевых пользователей</p>
                        <p>Акт о проведении инструктажа пользователей</p> 
                        <p>Экспертное заключение</p>
                  </div>
            </div>
             <div class="row">
                  <div class="col">
                        <h2>ОРД2</h2>
                  </div>
            </div>
             <div class="row">
                  <div class="col">
                        <button type="button" class="btn btn-link" onclick="generate('Проект_протокола_ПриемИсп')">Проект протокола приемочных испытаний</button>  
                  </div>
            </div>
            <div class="row">
                  <div class="col">
                        <button type="button" class="btn btn-link" onclick="generate('проект_акта_готовности_к_пром')">Проект акта готовности к приемке в промышленную эксплуатацию</button>  
                  </div>
            </div>        
            <div class="row">
                  <div class="col">
                        <button type="button" class="btn btn-link" onclick="generate('протокол_ОЭ')">Протокол опытной эксплуатации</button>  
                  </div>
            </div> 
            <div class="row">
                  <div class="col">
                        <button type="button" class="btn btn-link" onclick="generate('акт_завершения_ОЭ')">Акт о завершении опытной эксплуатации и допуске к приемочным испытаниям</button>
                  </div>
            </div>         
            <div class="row">
                  <div class="col">
                        <p>Экспертное заключение (делается заказчиком)</p>
                  </div>
              </div>
          </div>
              <div class="row">
                  <div class="col">
                        <h2>ОРД3</h2>
                  </div>
            </div>
             <div class="row">
                  <div class="col">
                        <p>Протокол приемочных испытаний</p>
                        <p>Отчет о проведении нагрузочного тестирования</p>
                        <p>Акт готовности к приемке в промышленную эксплуатацию</p>
                        <p>Отчет о проведении нагрузочного тестирования</p>
                  </div>
            </div>
          </div>
  <!--      <h2>ОРД3</h2>
        <p>Протокол приемочных испытаний</p>
        <p>Отчет о проведении нагрузочного тестирования</p>
        <p>Акт готовности к приемке в промышленную эксплуатацию</p>
        <p>Отчет о проведении нагрузочного тестирования</p>
        </div>     
   -->
        <script>
        
            var docs = document.getElementById("doc");
            
            function loadFile(url, callback) {
                PizZipUtils.getBinaryContent(url, callback);
            }

            function generate(templateFilename) {
            loadFile(
                window.location.href+"templates/"+templateFilename+".docx",
                function (error, content) {
                    if (error) {
                        throw error;
                    }
                    var zip = new PizZip(content);
                    var doc = new window.docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });
            
                    // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
                    var input_json = new Object();
                    input_json.second_comission_date=document.getElementById("second_comission_date").value;
                    input_json.queue_number=document.getElementById("queue_number").value;
                    input_json.queue_title=document.getElementById("queue_title").value;
                    input_json.queue_purpose=document.getElementById("queue_purpose").value;
                    input_json.trial_start_act_date=document.getElementById("trial_start_act_date").value;
                    input_json.trial_start=document.getElementById("trial_start").value;
                      
                    input_json.trial_start=document.getElementById("trial_start").value;
                    input_json.trial_end=document.getElementById("trial_end").value;
                    input_json.second_notification=document.getElementById("second_notification").value;
                    input_json.trial_experpise_start=document.getElementById("trial_experpise_start").value;
                    input_json.trial_experpise_end=document.getElementById("trial_experpise_end").value;
                    input_json.final_acceptance_act_date=document.getElementById("final_acceptance_act_date").value;
                    input_json.final_comission_start_date=document.getElementById("final_comission_start_date").value;
                    input_json.final_comission_end_date=document.getElementById("final_comission_end_date").value;
                    
                    
                    
                   // var input_json = JSON.parse(document.getElementById("input_json_params").value);
                    doc.render(input_json);

                    var out = doc.getZip().generate({
                        type: "blob",
                        mimeType:
                            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        // compression: DEFLATE adds a compression step.
                        // For a 50MB output document, expect 500ms additional CPU time
                        compression: "DEFLATE",
                    });
                    // Output the document using Data-URI
                    saveAs(out, templateFilename+" "+input_json.queue_number+".docx");
                }
            );
        };
            
          //filesystem load  
            function generate2() {
                var reader = new FileReader();
                if (docs.files.length === 0) {
                    alert("No files selected");
                }
                reader.readAsBinaryString(docs.files.item(0));
 
                reader.onerror = function (evt) {
                    console.log("error reading file", evt);
                    alert("error reading file" + evt);
                };
                reader.onload = function (evt) {
                    const content = evt.target.result;
                    var zip = new PizZip(content);
                    var doc = new window.docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });
 

                    // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
                    console.log(input_json);
                    doc.render(input_json);
 
                    var out = doc.getZip().generate({
                        type: "blob",
                        mimeType:
                            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        // compression: DEFLATE adds a compression step.
                        // For a 50MB output document, expect 500ms additional CPU time
                        compression: "DEFLATE",
                    });
                    // Output the document using Data-URI
                    saveAs(out, "output.docx");
                };
            }
        </script>
    </body>
</html>
