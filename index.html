<!DOCTYPE html>
<html>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.31.2/docxtemplater.js"></script>
        <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
        <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils.js"></script>
        <!--
Mandatory in IE 6, 7, 8 and 9.
-->
        <!--[if IE]>
            <script
                type="text/javascript"
                src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils-ie.js"
            ></script>
        <![endif]-->
        
     <!-- input feed for document-->
        <h1>Данные для документов</h1>
        <textarea rows="4" cols="50" id="input_json_params">
        {
          "second_comission_date": "15.08.2022",
          "queue_number": "16.1",
          "queue_title": "Сервис '15 партнерских услуг'(4.2.16 (в части требований, приведенных в пп. 1.1. (по не более чем 4 новым услугам), 2 (в количестве не более чем 4), 3.2.)",
          "queue_purpose": "Доработка процесса оказания услуги на базе сервиса 'Экспертная платформа' в часте подтвверждения опыта партнеров, а также создание 4 новых услуг"
        }
        </textarea>
        
<!--        <input type="file" id="doc" /> -->
        <h1>Сгенерировать документы</h1>
        <h2>ОРД1</h2>
        
        <p>Проект журнала опытной эксплуатации</p>
        <button onclick="generate('tag-example.docx')">Generate document</button>
        
        <p>Проект протокола предварительных испытаний</p>
        
        <p>Проект акта приёмки в опытную эксплуатацию</p>
        
        <p>Проект протокола опытной эксплуатации</p>
        
        <p>Проект акта о завершении опытной эксплуатации и допуске к приемочным испытаниям</p>
        
        <p>Протокол предварительных испытаний</p>
        
        <p>Журнал проведения инструктажа</p>
        <p>Акт приемки в опытную эксплуатацию</p>
        <p>Отчет о результатах тестирования ключевых пользователей</p>
        <p>Акт о проведении инструктажа пользователей</p>
        <p>Экспертное заключение</p>
        
        <h2>ОРД2</h2>
        <p>Проект протокола приемочных испытаний</p>
        
        <p>Проект акта готовности к приемке в промышленную эксплуатацию</p>
        <p>Протокол опытной эксплуатации</p>
        
        <p>Акт о завершении опытной эксплуатации и допуске к приемочным испытаниям</p>
        <button onclick="generate('акт_завершения_ОЭ.docx')">Generate document</button>
        <p>Экспертное заключение</p>
        
        <h2>ОРД3</h2>
        <p>Протокол приемочных испытаний</p>
        <p>Отчет о проведении нагрузочного тестирования</p>
        <p>Акт готовности к приемке в промышленную эксплуатацию</p>
        <p>Отчет о проведении нагрузочного тестирования</p>
        
        <script>
        
            var docs = document.getElementById("doc");
            
            function loadFile(url, callback) {
                PizZipUtils.getBinaryContent(url, callback);
            }

            function generate(templateFilename) {
            loadFile(
                window.location.href+"templates/"+templateFilename,
                function (error, content) {
                    if (error) {
                        throw error;
                    }
                    var zip = new PizZip(content);
                    var doc = new window.docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });

                    // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
                    var input_json = JSON.parse(document.getElementById("input_json_params").value);
                    doc.render(input_json);

                    var out = doc.getZip().generate({
                        type: "blob",
                        mimeType:
                            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        // compression: DEFLATE adds a compression step.
                        // For a 50MB output document, expect 500ms additional CPU time
                        compression: "DEFLATE",
                    });
                    // Output the document using Data-URI
                    saveAs(out, "output.docx");
                }
            );
        };
            
          //filesystem load  
            function generate2() {
                var reader = new FileReader();
                if (docs.files.length === 0) {
                    alert("No files selected");
                }
                reader.readAsBinaryString(docs.files.item(0));
 
                reader.onerror = function (evt) {
                    console.log("error reading file", evt);
                    alert("error reading file" + evt);
                };
                reader.onload = function (evt) {
                    const content = evt.target.result;
                    var zip = new PizZip(content);
                    var doc = new window.docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });
 

                    // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
                    console.log(input_json);
                    doc.render(input_json);
 
                    var out = doc.getZip().generate({
                        type: "blob",
                        mimeType:
                            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        // compression: DEFLATE adds a compression step.
                        // For a 50MB output document, expect 500ms additional CPU time
                        compression: "DEFLATE",
                    });
                    // Output the document using Data-URI
                    saveAs(out, "output.docx");
                };
            }
        </script>
    </body>
</html>
